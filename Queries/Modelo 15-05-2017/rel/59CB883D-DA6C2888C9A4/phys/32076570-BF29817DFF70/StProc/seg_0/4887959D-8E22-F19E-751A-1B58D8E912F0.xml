<?xml version = '1.0' encoding = 'UTF-8'?>
<StoredProcedureOraclev10g class="oracle.dbtools.crest.model.design.storage.oracle.v10g.StoredProcedureOraclev10g" name="GET_PRESUPUESTO_AREAS" directorySegmentName="seg_0" id="4887959D-8E22-F19E-751A-1B58D8E912F0">
<sourceConnName>Desarrollo2</sourceConnName>
<sourceObjSchema>CONSULTOR3</sourceObjSchema>
<sourceObjName>GET_PRESUPUESTO_AREAS</sourceObjName>
<createdBy>consultor3</createdBy>
<createdTime>2017-05-16 03:15:38 UTC</createdTime>
<ownerDesignName>Modelo 15-05-2017</ownerDesignName>
<owner>AE2292FC-43E2-FF51-8677-819EDD136431</owner>
<source>CREATE OR REPLACE PROCEDURE CONSULTOR3.GET_PRESUPUESTO_AREAS(VAR_ID_PRESUP IN NUMBER,CUR_RPTA OUT sys_refcursor)IS&lt;br/&gt;BEGIN&lt;br/&gt;&lt;br/&gt;    SAVEPOINT obtenerResultados;&lt;br/&gt;&lt;br/&gt;    OPEN CUR_RPTA FOR&lt;br/&gt;    select a.ID_AREA,  c.ID_PRESUPUESTO,&lt;br/&gt;        NVL(sum(d.TOTAL_SOLIC),0) as monto,&lt;br/&gt;        NVL(max(d.DET_V_ULT_FEC),max(a.V_ULT_MODIF_FEC)) as ultmodif,&lt;br/&gt;        min(a.V_FECHA_VAL_INI) as fechavalIni,&lt;br/&gt;        max(a.V_FECHA_VAL_FIN) as fechavalfin&lt;br/&gt;        --select *&lt;br/&gt;        from t_version a&lt;br/&gt;        inner join T_DET_PRESUP c on a.ID_DET_PRESUP=c.ID_DET_PRESUP&lt;br/&gt;        left join T_DET_VERSION d on a.ID_VERSION=d.ID_VERSION&lt;br/&gt;        inner join&lt;br/&gt;        (SELECT&lt;br/&gt;            max(nro) as nro,&lt;br/&gt;            ID_DET_PRESUP,&lt;br/&gt;            id_area&lt;br/&gt;        FROM&lt;br/&gt;            t_version &lt;br/&gt;            group by ID_DET_PRESUP,id_area) b &lt;br/&gt;            on a.nro=b.nro and a.ID_DET_PRESUP=b.ID_DET_PRESUP and a.id_area=b.id_area&lt;br/&gt;            where  c.ID_PRESUPUESTO=VAR_ID_PRESUP&lt;br/&gt;                group by c.ID_PRESUPUESTO,a.ID_AREA ;&lt;br/&gt;&lt;br/&gt;    EXCEPTION &lt;br/&gt;        WHEN OTHERS THEN&lt;br/&gt;&lt;br/&gt;            ROLLBACK TO obtenerResultados;&lt;br/&gt;            RAISE;&lt;br/&gt;END;</source>
<body>CREATE OR REPLACE PROCEDURE CONSULTOR3.GET_PRESUPUESTO_AREAS(VAR_ID_PRESUP IN NUMBER,CUR_RPTA OUT sys_refcursor)IS&lt;br/&gt;BEGIN&lt;br/&gt;&lt;br/&gt;    SAVEPOINT obtenerResultados;&lt;br/&gt;&lt;br/&gt;    OPEN CUR_RPTA FOR&lt;br/&gt;    select a.ID_AREA,  c.ID_PRESUPUESTO,&lt;br/&gt;        NVL(sum(d.TOTAL_SOLIC),0) as monto,&lt;br/&gt;        NVL(max(d.DET_V_ULT_FEC),max(a.V_ULT_MODIF_FEC)) as ultmodif,&lt;br/&gt;        min(a.V_FECHA_VAL_INI) as fechavalIni,&lt;br/&gt;        max(a.V_FECHA_VAL_FIN) as fechavalfin&lt;br/&gt;        --select *&lt;br/&gt;        from t_version a&lt;br/&gt;        inner join T_DET_PRESUP c on a.ID_DET_PRESUP=c.ID_DET_PRESUP&lt;br/&gt;        left join T_DET_VERSION d on a.ID_VERSION=d.ID_VERSION&lt;br/&gt;        inner join&lt;br/&gt;        (SELECT&lt;br/&gt;            max(nro) as nro,&lt;br/&gt;            ID_DET_PRESUP,&lt;br/&gt;            id_area&lt;br/&gt;        FROM&lt;br/&gt;            t_version &lt;br/&gt;            group by ID_DET_PRESUP,id_area) b &lt;br/&gt;            on a.nro=b.nro and a.ID_DET_PRESUP=b.ID_DET_PRESUP and a.id_area=b.id_area&lt;br/&gt;            where  c.ID_PRESUPUESTO=VAR_ID_PRESUP&lt;br/&gt;                group by c.ID_PRESUPUESTO,a.ID_AREA ;&lt;br/&gt;&lt;br/&gt;    EXCEPTION &lt;br/&gt;        WHEN OTHERS THEN&lt;br/&gt;&lt;br/&gt;            ROLLBACK TO obtenerResultados;&lt;br/&gt;            RAISE;&lt;br/&gt;END;</body>
</StoredProcedureOraclev10g>