<?xml version = '1.0' encoding = 'UTF-8'?>
<StoredProcedureOraclev10g class="oracle.dbtools.crest.model.design.storage.oracle.v10g.StoredProcedureOraclev10g" name="INS_DETALLE_VERSION" directorySegmentName="seg_0" id="B2BA44F9-D676-19FD-538A-3B20E91836A7">
<sourceConnName>Desarrollo2</sourceConnName>
<sourceObjSchema>CONSULTOR3</sourceObjSchema>
<sourceObjName>INS_DETALLE_VERSION</sourceObjName>
<createdBy>consultor3</createdBy>
<createdTime>2017-05-16 03:15:38 UTC</createdTime>
<ownerDesignName>Modelo 15-05-2017</ownerDesignName>
<owner>AE2292FC-43E2-FF51-8677-819EDD136431</owner>
<source>CREATE OR REPLACE PROCEDURE CONSULTOR3.INS_DETALLE_VERSION (&lt;br/&gt;VAR_COD_MATERIAL IN VARCHAR2,&lt;br/&gt;VAR_NOMB_MATERIAL IN VARCHAR2,&lt;br/&gt;VAR_CANT_SOLIC IN NUMBER,&lt;br/&gt;VAR_PRECIO_UNIT IN NUMBER,&lt;br/&gt;VAR_CRITICIDAD IN NUMBER,&lt;br/&gt;VAR_TIPO IN NUMBER,&lt;br/&gt;VAR_LARGO IN NUMBER,&lt;br/&gt;VAR_ANCHO IN NUMBER,&lt;br/&gt;VAR_ALTO IN NUMBER,&lt;br/&gt;VAR_SUSTENTO IN VARCHAR2,&lt;br/&gt;VAR_UNID_SOLI IN VARCHAR2,&lt;br/&gt;VAR_USUARIO_REG IN VARCHAR2,&lt;br/&gt;VAR_ID_MESES_SOL IN VARCHAR2,&lt;br/&gt;VAR_ID_MESES_ENT IN VARCHAR2,&lt;br/&gt;VAR_ID_PRIORIDAD IN NUMBER,&lt;br/&gt;VAR_ID_VERSION IN NUMBER,&lt;br/&gt;VAR_NOMB_ARCHIVO IN VARCHAR2, &lt;br/&gt;VAR_TIPO_ARCHIVO IN VARCHAR2, &lt;br/&gt;VAR_RUTA_ARCHIVO IN VARCHAR2, &lt;br/&gt;CUR_RPTA OUT sys_refcursor)AS&lt;br/&gt;&lt;br/&gt;VAR_ID_DET_VERSION NUMBER;&lt;br/&gt;ID_ARCHIVO_INS NUMBER;&lt;br/&gt;BEGIN&lt;br/&gt;	&lt;br/&gt;    SAVEPOINT obtenerResultados;&lt;br/&gt;	&lt;br/&gt;	INSERT INTO T_DET_VERSION (COD_MATERIAL,NOMB_MATERIAL,CANT_SOLIC,PRECIO_UNI_SOLIC,CRITICIDAD,TOTAL_SOLIC,&lt;br/&gt;	TIPO,LARGO,ANCHO,ALTO,SUSTENTO,UNID_SOLI, DET_V_FEC_REG,DET_V_USR_REG,DET_V_ULT_FEC,DET_V_ULT_USR,&lt;br/&gt;	ID_PRIORIDAD,ID_VERSION) VALUES&lt;br/&gt;	(VAR_COD_MATERIAL,VAR_NOMB_MATERIAL,VAR_CANT_SOLIC, VAR_PRECIO_UNIT,VAR_CRITICIDAD,(VAR_CANT_SOLIC*VAR_PRECIO_UNIT),&lt;br/&gt;	VAR_TIPO,VAR_LARGO,VAR_ANCHO,VAR_ALTO,VAR_SUSTENTO,VAR_UNID_SOLI,SYSDATE,VAR_USUARIO_REG,&lt;br/&gt;	SYSDATE,VAR_USUARIO_REG,VAR_ID_PRIORIDAD,VAR_ID_VERSION)&lt;br/&gt;	RETURNING ID_DETALLE INTO VAR_ID_DET_VERSION;&lt;br/&gt;	&lt;br/&gt;	INSERT INTO T_MES_ENT_SOL (ID_DETALLE,MES,TIPO,MES_ENT_FEC_REG,MES_ENT_USR_REG)&lt;br/&gt;	SELECT &lt;br/&gt;	VAR_ID_DET_VERSION,&lt;br/&gt;	regexp_substr(VAR_ID_MESES_SOL,&apos;[^,]+&apos;,1,LEVEL) AS ID_MES_SOL ,&lt;br/&gt;	0,SYSDATE,VAR_USUARIO_REG&lt;br/&gt;	FROM DUAL&lt;br/&gt;	connect by regexp_substr(VAR_ID_MESES_SOL,&apos;[^,]+&apos;,1,LEVEL) is not null ;&lt;br/&gt;	&lt;br/&gt;	INSERT INTO T_MES_ENT_SOL (ID_DETALLE,MES,TIPO,MES_ENT_FEC_REG,MES_ENT_USR_REG)&lt;br/&gt;	SELECT &lt;br/&gt;	VAR_ID_DET_VERSION,&lt;br/&gt;	regexp_substr(VAR_ID_MESES_ENT,&apos;[^,]+&apos;,1,LEVEL) AS ID_MES_ENT ,&lt;br/&gt;	1,SYSDATE,VAR_USUARIO_REG&lt;br/&gt;	FROM DUAL&lt;br/&gt;	connect by regexp_substr(VAR_ID_MESES_ENT,&apos;[^,]+&apos;,1,LEVEL) is not null ;&lt;br/&gt;    &lt;br/&gt;    IF VAR_RUTA_ARCHIVO IS NOT NULL AND VAR_RUTA_ARCHIVO &lt;&gt;&apos;&apos; THEN&lt;br/&gt;    &lt;br/&gt;        INSERT INTO T_ARCHIVO (NOMB_ARCHIVO,TIPO_ARCHIVO,RUTA_ARCHIVO,ARCH_FEC_REG,ARCH_USR_REG)&lt;br/&gt;        VALUES&lt;br/&gt;        (VAR_NOMB_ARCHIVO,VAR_TIPO_ARCHIVO,VAR_RUTA_ARCHIVO,SYSDATE,VAR_USUARIO_REG)&lt;br/&gt;        RETURNING ID_ARCHIVO INTO ID_ARCHIVO_INS;&lt;br/&gt;    &lt;br/&gt;        INSERT INTO T_DET_ARCHIVO(ID_DETALLE,ID_ARCHIVO)&lt;br/&gt;        VALUES&lt;br/&gt;        (VAR_ID_DET_VERSION,ID_ARCHIVO_INS);&lt;br/&gt;    END IF;&lt;br/&gt;&lt;br/&gt;	OPEN CUR_RPTA FOR&lt;br/&gt;    select ID_DETALLE,COD_MATERIAL,CANT_SOLIC,PRECIO_UNI_SOLIC,CRITICIDAD,&lt;br/&gt;    TOTAL_SOLIC,TIPO,LARGO,ANCHO,ALTO,SUSTENTO,UNID_SOLI,DET_V_FEC_REG,&lt;br/&gt;    DET_V_ULT_FEC,DET_V_USR_REG,DET_V_ULT_USR,ID_PRIORIDAD,ID_VERSION &lt;br/&gt;    from T_DET_VERSION &lt;br/&gt;    WHERE ID_DETALLE=VAR_ID_DET_VERSION;&lt;br/&gt;	&lt;br/&gt;EXCEPTION &lt;br/&gt;        WHEN OTHERS THEN&lt;br/&gt;&lt;br/&gt;            ROLLBACK TO obtenerResultados;&lt;br/&gt;            RAISE;&lt;br/&gt;END;</source>
<body>CREATE OR REPLACE PROCEDURE CONSULTOR3.INS_DETALLE_VERSION (&lt;br/&gt;VAR_COD_MATERIAL IN VARCHAR2,&lt;br/&gt;VAR_NOMB_MATERIAL IN VARCHAR2,&lt;br/&gt;VAR_CANT_SOLIC IN NUMBER,&lt;br/&gt;VAR_PRECIO_UNIT IN NUMBER,&lt;br/&gt;VAR_CRITICIDAD IN NUMBER,&lt;br/&gt;VAR_TIPO IN NUMBER,&lt;br/&gt;VAR_LARGO IN NUMBER,&lt;br/&gt;VAR_ANCHO IN NUMBER,&lt;br/&gt;VAR_ALTO IN NUMBER,&lt;br/&gt;VAR_SUSTENTO IN VARCHAR2,&lt;br/&gt;VAR_UNID_SOLI IN VARCHAR2,&lt;br/&gt;VAR_USUARIO_REG IN VARCHAR2,&lt;br/&gt;VAR_ID_MESES_SOL IN VARCHAR2,&lt;br/&gt;VAR_ID_MESES_ENT IN VARCHAR2,&lt;br/&gt;VAR_ID_PRIORIDAD IN NUMBER,&lt;br/&gt;VAR_ID_VERSION IN NUMBER,&lt;br/&gt;VAR_NOMB_ARCHIVO IN VARCHAR2, &lt;br/&gt;VAR_TIPO_ARCHIVO IN VARCHAR2, &lt;br/&gt;VAR_RUTA_ARCHIVO IN VARCHAR2, &lt;br/&gt;CUR_RPTA OUT sys_refcursor)AS&lt;br/&gt;&lt;br/&gt;VAR_ID_DET_VERSION NUMBER;&lt;br/&gt;ID_ARCHIVO_INS NUMBER;&lt;br/&gt;BEGIN&lt;br/&gt;	&lt;br/&gt;    SAVEPOINT obtenerResultados;&lt;br/&gt;	&lt;br/&gt;	INSERT INTO T_DET_VERSION (COD_MATERIAL,NOMB_MATERIAL,CANT_SOLIC,PRECIO_UNI_SOLIC,CRITICIDAD,TOTAL_SOLIC,&lt;br/&gt;	TIPO,LARGO,ANCHO,ALTO,SUSTENTO,UNID_SOLI, DET_V_FEC_REG,DET_V_USR_REG,DET_V_ULT_FEC,DET_V_ULT_USR,&lt;br/&gt;	ID_PRIORIDAD,ID_VERSION) VALUES&lt;br/&gt;	(VAR_COD_MATERIAL,VAR_NOMB_MATERIAL,VAR_CANT_SOLIC, VAR_PRECIO_UNIT,VAR_CRITICIDAD,(VAR_CANT_SOLIC*VAR_PRECIO_UNIT),&lt;br/&gt;	VAR_TIPO,VAR_LARGO,VAR_ANCHO,VAR_ALTO,VAR_SUSTENTO,VAR_UNID_SOLI,SYSDATE,VAR_USUARIO_REG,&lt;br/&gt;	SYSDATE,VAR_USUARIO_REG,VAR_ID_PRIORIDAD,VAR_ID_VERSION)&lt;br/&gt;	RETURNING ID_DETALLE INTO VAR_ID_DET_VERSION;&lt;br/&gt;	&lt;br/&gt;	INSERT INTO T_MES_ENT_SOL (ID_DETALLE,MES,TIPO,MES_ENT_FEC_REG,MES_ENT_USR_REG)&lt;br/&gt;	SELECT &lt;br/&gt;	VAR_ID_DET_VERSION,&lt;br/&gt;	regexp_substr(VAR_ID_MESES_SOL,&apos;[^,]+&apos;,1,LEVEL) AS ID_MES_SOL ,&lt;br/&gt;	0,SYSDATE,VAR_USUARIO_REG&lt;br/&gt;	FROM DUAL&lt;br/&gt;	connect by regexp_substr(VAR_ID_MESES_SOL,&apos;[^,]+&apos;,1,LEVEL) is not null ;&lt;br/&gt;	&lt;br/&gt;	INSERT INTO T_MES_ENT_SOL (ID_DETALLE,MES,TIPO,MES_ENT_FEC_REG,MES_ENT_USR_REG)&lt;br/&gt;	SELECT &lt;br/&gt;	VAR_ID_DET_VERSION,&lt;br/&gt;	regexp_substr(VAR_ID_MESES_ENT,&apos;[^,]+&apos;,1,LEVEL) AS ID_MES_ENT ,&lt;br/&gt;	1,SYSDATE,VAR_USUARIO_REG&lt;br/&gt;	FROM DUAL&lt;br/&gt;	connect by regexp_substr(VAR_ID_MESES_ENT,&apos;[^,]+&apos;,1,LEVEL) is not null ;&lt;br/&gt;    &lt;br/&gt;    IF VAR_RUTA_ARCHIVO IS NOT NULL AND VAR_RUTA_ARCHIVO &lt;&gt;&apos;&apos; THEN&lt;br/&gt;    &lt;br/&gt;        INSERT INTO T_ARCHIVO (NOMB_ARCHIVO,TIPO_ARCHIVO,RUTA_ARCHIVO,ARCH_FEC_REG,ARCH_USR_REG)&lt;br/&gt;        VALUES&lt;br/&gt;        (VAR_NOMB_ARCHIVO,VAR_TIPO_ARCHIVO,VAR_RUTA_ARCHIVO,SYSDATE,VAR_USUARIO_REG)&lt;br/&gt;        RETURNING ID_ARCHIVO INTO ID_ARCHIVO_INS;&lt;br/&gt;    &lt;br/&gt;        INSERT INTO T_DET_ARCHIVO(ID_DETALLE,ID_ARCHIVO)&lt;br/&gt;        VALUES&lt;br/&gt;        (VAR_ID_DET_VERSION,ID_ARCHIVO_INS);&lt;br/&gt;    END IF;&lt;br/&gt;&lt;br/&gt;	OPEN CUR_RPTA FOR&lt;br/&gt;    select ID_DETALLE,COD_MATERIAL,CANT_SOLIC,PRECIO_UNI_SOLIC,CRITICIDAD,&lt;br/&gt;    TOTAL_SOLIC,TIPO,LARGO,ANCHO,ALTO,SUSTENTO,UNID_SOLI,DET_V_FEC_REG,&lt;br/&gt;    DET_V_ULT_FEC,DET_V_USR_REG,DET_V_ULT_USR,ID_PRIORIDAD,ID_VERSION &lt;br/&gt;    from T_DET_VERSION &lt;br/&gt;    WHERE ID_DETALLE=VAR_ID_DET_VERSION;&lt;br/&gt;	&lt;br/&gt;EXCEPTION &lt;br/&gt;        WHEN OTHERS THEN&lt;br/&gt;&lt;br/&gt;            ROLLBACK TO obtenerResultados;&lt;br/&gt;            RAISE;&lt;br/&gt;END;</body>
</StoredProcedureOraclev10g>