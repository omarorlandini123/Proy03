<?xml version = '1.0' encoding = 'UTF-8'?>
<StoredProcedureOraclev10g class="oracle.dbtools.crest.model.design.storage.oracle.v10g.StoredProcedureOraclev10g" name="GET_DETALLES_PRESUP_POR_TIPO" directorySegmentName="seg_0" id="793B2D9C-3A74-5BCA-1FBA-316252DB46A3">
<sourceConnName>Desarrollo2</sourceConnName>
<sourceObjSchema>CONSULTOR3</sourceObjSchema>
<sourceObjName>GET_DETALLES_PRESUP_POR_TIPO</sourceObjName>
<createdBy>consultor3</createdBy>
<createdTime>2017-05-16 03:15:38 UTC</createdTime>
<ownerDesignName>Modelo 15-05-2017</ownerDesignName>
<owner>AE2292FC-43E2-FF51-8677-819EDD136431</owner>
<source>CREATE OR REPLACE PROCEDURE CONSULTOR3.GET_DETALLES_PRESUP_POR_TIPO (&lt;br/&gt;  VAR_ID_PRESUP IN NUMBER,&lt;br/&gt;  CUR_RPTA OUT SYS_REFCURSOR ) AS&lt;br/&gt; BEGIN&lt;br/&gt;&lt;br/&gt;    SAVEPOINT obtenerResultados;&lt;br/&gt;	&lt;br/&gt;	OPEN CUR_RPTA FOR&lt;br/&gt;	SELECT DET_P_EST_ACTUAL, ID_PRESUPUESTO, &lt;br/&gt;	DET_P_FECHA_REG, DET_P_USR_REG, DET_P_ULT_MODIF_FEC, &lt;br/&gt;	DET_P_MODIF_USR, DET_P_FECHA_VAL_INI, DET_P_FECHA_VAL_FIN,&lt;br/&gt;	B.ID_TIPO_PRESUP,B.NOMBRE,NVL(SUM(D.TOTAL_SOLIC),0) MONTO&lt;br/&gt;	--SELECT *&lt;br/&gt;	FROM&lt;br/&gt;		T_DET_PRESUP A&lt;br/&gt;		INNER JOIN T_TIPO_PRESUP B ON A.ID_TIPO=B.ID_TIPO_PRESUP&lt;br/&gt;		LEFT JOIN T_VERSION C ON A.ID_DET_PRESUP=C.ID_DET_PRESUP &lt;br/&gt;		INNER JOIN (&lt;br/&gt;			SELECT max(nro) as nro, ID_DET_PRESUP,id_area&lt;br/&gt;			FROM t_version  group by ID_DET_PRESUP,id_area&lt;br/&gt;		) H ON C.NRO=H.NRO AND C.ID_DET_PRESUP=H.ID_DET_PRESUP AND C.ID_AREA=H.ID_AREA&lt;br/&gt;		LEFT JOIN T_DET_VERSION D ON C.ID_VERSION=D.ID_VERSION&lt;br/&gt;	WHERE A.ID_PRESUPUESTO=VAR_ID_PRESUP&lt;br/&gt;	GROUP BY &lt;br/&gt;		DET_P_EST_ACTUAL, ID_PRESUPUESTO, &lt;br/&gt;		DET_P_FECHA_REG, DET_P_USR_REG, DET_P_ULT_MODIF_FEC, &lt;br/&gt;		DET_P_MODIF_USR, DET_P_FECHA_VAL_INI, DET_P_FECHA_VAL_FIN,&lt;br/&gt;		B.ID_TIPO_PRESUP,B.NOMBRE;&lt;br/&gt;	&lt;br/&gt;	&lt;br/&gt;&lt;br/&gt;EXCEPTION &lt;br/&gt;        WHEN OTHERS THEN&lt;br/&gt;&lt;br/&gt;            ROLLBACK TO obtenerResultados;&lt;br/&gt;            RAISE;&lt;br/&gt;END;</source>
<body>CREATE OR REPLACE PROCEDURE CONSULTOR3.GET_DETALLES_PRESUP_POR_TIPO (&lt;br/&gt;  VAR_ID_PRESUP IN NUMBER,&lt;br/&gt;  CUR_RPTA OUT SYS_REFCURSOR ) AS&lt;br/&gt; BEGIN&lt;br/&gt;&lt;br/&gt;    SAVEPOINT obtenerResultados;&lt;br/&gt;	&lt;br/&gt;	OPEN CUR_RPTA FOR&lt;br/&gt;	SELECT DET_P_EST_ACTUAL, ID_PRESUPUESTO, &lt;br/&gt;	DET_P_FECHA_REG, DET_P_USR_REG, DET_P_ULT_MODIF_FEC, &lt;br/&gt;	DET_P_MODIF_USR, DET_P_FECHA_VAL_INI, DET_P_FECHA_VAL_FIN,&lt;br/&gt;	B.ID_TIPO_PRESUP,B.NOMBRE,NVL(SUM(D.TOTAL_SOLIC),0) MONTO&lt;br/&gt;	--SELECT *&lt;br/&gt;	FROM&lt;br/&gt;		T_DET_PRESUP A&lt;br/&gt;		INNER JOIN T_TIPO_PRESUP B ON A.ID_TIPO=B.ID_TIPO_PRESUP&lt;br/&gt;		LEFT JOIN T_VERSION C ON A.ID_DET_PRESUP=C.ID_DET_PRESUP &lt;br/&gt;		INNER JOIN (&lt;br/&gt;			SELECT max(nro) as nro, ID_DET_PRESUP,id_area&lt;br/&gt;			FROM t_version  group by ID_DET_PRESUP,id_area&lt;br/&gt;		) H ON C.NRO=H.NRO AND C.ID_DET_PRESUP=H.ID_DET_PRESUP AND C.ID_AREA=H.ID_AREA&lt;br/&gt;		LEFT JOIN T_DET_VERSION D ON C.ID_VERSION=D.ID_VERSION&lt;br/&gt;	WHERE A.ID_PRESUPUESTO=VAR_ID_PRESUP&lt;br/&gt;	GROUP BY &lt;br/&gt;		DET_P_EST_ACTUAL, ID_PRESUPUESTO, &lt;br/&gt;		DET_P_FECHA_REG, DET_P_USR_REG, DET_P_ULT_MODIF_FEC, &lt;br/&gt;		DET_P_MODIF_USR, DET_P_FECHA_VAL_INI, DET_P_FECHA_VAL_FIN,&lt;br/&gt;		B.ID_TIPO_PRESUP,B.NOMBRE;&lt;br/&gt;	&lt;br/&gt;	&lt;br/&gt;&lt;br/&gt;EXCEPTION &lt;br/&gt;        WHEN OTHERS THEN&lt;br/&gt;&lt;br/&gt;            ROLLBACK TO obtenerResultados;&lt;br/&gt;            RAISE;&lt;br/&gt;END;</body>
</StoredProcedureOraclev10g>