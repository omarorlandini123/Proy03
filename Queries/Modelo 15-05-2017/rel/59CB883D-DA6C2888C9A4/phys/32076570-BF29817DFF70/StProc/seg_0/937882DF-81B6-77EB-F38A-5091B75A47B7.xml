<?xml version = '1.0' encoding = 'UTF-8'?>
<StoredProcedureOraclev10g class="oracle.dbtools.crest.model.design.storage.oracle.v10g.StoredProcedureOraclev10g" name="GET_DETALLES_PRESUP" directorySegmentName="seg_0" id="937882DF-81B6-77EB-F38A-5091B75A47B7">
<sourceConnName>Desarrollo2</sourceConnName>
<sourceObjSchema>CONSULTOR3</sourceObjSchema>
<sourceObjName>GET_DETALLES_PRESUP</sourceObjName>
<createdBy>consultor3</createdBy>
<createdTime>2017-05-16 03:15:38 UTC</createdTime>
<ownerDesignName>Modelo 15-05-2017</ownerDesignName>
<owner>AE2292FC-43E2-FF51-8677-819EDD136431</owner>
<source>CREATE OR REPLACE PROCEDURE CONSULTOR3.GET_DETALLES_PRESUP (VAR_ID_PRESUPUESTO IN NUMBER,CUR_RPTA OUT sys_refcursor)IS&lt;br/&gt;BEGIN&lt;br/&gt;&lt;br/&gt;    SAVEPOINT obtenerResultados;&lt;br/&gt;&lt;br/&gt;    OPEN CUR_RPTA FOR&lt;br/&gt;    SELECT&lt;br/&gt;    A.ID_DET_PRESUP,&lt;br/&gt;    A.id_presupuesto,&lt;br/&gt;    A.id_tipo,&lt;br/&gt;    A.DET_P_fecha_reg,&lt;br/&gt;	A.DET_P_usr_reg,&lt;br/&gt;    A.DET_P_ult_modif_fec,&lt;br/&gt;    A.DET_P_modif_usr,&lt;br/&gt;    A.DET_P_fecha_val_ini,&lt;br/&gt;    A.DET_P_fecha_val_fin,&lt;br/&gt;    A.DET_P_est_actual,&lt;br/&gt;    B.ID_TIPO_PRESUP,&lt;br/&gt;    B.NOMBRE,&lt;br/&gt;    NVL(SUM(E.TOTAL_SOLIC),0) MONTO&lt;br/&gt;    FROM T_DET_PRESUP A&lt;br/&gt;    INNER JOIN T_TIPO_PRESUP B ON A.ID_TIPO=B.ID_TIPO_PRESUP&lt;br/&gt;    INNER JOIN  T_VERSION C ON A.ID_DET_PRESUP=C.ID_DET_PRESUP &lt;br/&gt;    INNER JOIN (SELECT max(nro) as nro,ID_DET_PRESUP,id_area&lt;br/&gt;        FROM t_version group by ID_DET_PRESUP,id_area) D &lt;br/&gt;        ON C.NRO=D.NRO  AND D.ID_AREA=C.ID_AREA and D.ID_DET_PRESUP=A.ID_DET_PRESUP&lt;br/&gt;    LEFT JOIN T_DET_VERSION E ON E.ID_VERSION=C.ID_VERSION&lt;br/&gt;    WHERE A.id_presupuesto=VAR_ID_PRESUPUESTO&lt;br/&gt;    GROUP BY A.ID_DET_PRESUP,&lt;br/&gt;    A.id_presupuesto,&lt;br/&gt;    A.id_tipo,&lt;br/&gt;    A.DET_P_fecha_reg,&lt;br/&gt;	A.DET_P_usr_reg,&lt;br/&gt;    A.DET_P_ult_modif_fec,&lt;br/&gt;    A.DET_P_modif_usr,&lt;br/&gt;    A.DET_P_fecha_val_ini,&lt;br/&gt;    A.DET_P_fecha_val_fin,&lt;br/&gt;    A.DET_P_est_actual,&lt;br/&gt;    B.ID_TIPO_PRESUP,&lt;br/&gt;    B.NOMBRE;&lt;br/&gt;&lt;br/&gt;EXCEPTION &lt;br/&gt;        WHEN OTHERS THEN&lt;br/&gt;&lt;br/&gt;            ROLLBACK TO obtenerResultados;&lt;br/&gt;            RAISE;&lt;br/&gt;END;</source>
<body>CREATE OR REPLACE PROCEDURE CONSULTOR3.GET_DETALLES_PRESUP (VAR_ID_PRESUPUESTO IN NUMBER,CUR_RPTA OUT sys_refcursor)IS&lt;br/&gt;BEGIN&lt;br/&gt;&lt;br/&gt;    SAVEPOINT obtenerResultados;&lt;br/&gt;&lt;br/&gt;    OPEN CUR_RPTA FOR&lt;br/&gt;    SELECT&lt;br/&gt;    A.ID_DET_PRESUP,&lt;br/&gt;    A.id_presupuesto,&lt;br/&gt;    A.id_tipo,&lt;br/&gt;    A.DET_P_fecha_reg,&lt;br/&gt;	A.DET_P_usr_reg,&lt;br/&gt;    A.DET_P_ult_modif_fec,&lt;br/&gt;    A.DET_P_modif_usr,&lt;br/&gt;    A.DET_P_fecha_val_ini,&lt;br/&gt;    A.DET_P_fecha_val_fin,&lt;br/&gt;    A.DET_P_est_actual,&lt;br/&gt;    B.ID_TIPO_PRESUP,&lt;br/&gt;    B.NOMBRE,&lt;br/&gt;    NVL(SUM(E.TOTAL_SOLIC),0) MONTO&lt;br/&gt;    FROM T_DET_PRESUP A&lt;br/&gt;    INNER JOIN T_TIPO_PRESUP B ON A.ID_TIPO=B.ID_TIPO_PRESUP&lt;br/&gt;    INNER JOIN  T_VERSION C ON A.ID_DET_PRESUP=C.ID_DET_PRESUP &lt;br/&gt;    INNER JOIN (SELECT max(nro) as nro,ID_DET_PRESUP,id_area&lt;br/&gt;        FROM t_version group by ID_DET_PRESUP,id_area) D &lt;br/&gt;        ON C.NRO=D.NRO  AND D.ID_AREA=C.ID_AREA and D.ID_DET_PRESUP=A.ID_DET_PRESUP&lt;br/&gt;    LEFT JOIN T_DET_VERSION E ON E.ID_VERSION=C.ID_VERSION&lt;br/&gt;    WHERE A.id_presupuesto=VAR_ID_PRESUPUESTO&lt;br/&gt;    GROUP BY A.ID_DET_PRESUP,&lt;br/&gt;    A.id_presupuesto,&lt;br/&gt;    A.id_tipo,&lt;br/&gt;    A.DET_P_fecha_reg,&lt;br/&gt;	A.DET_P_usr_reg,&lt;br/&gt;    A.DET_P_ult_modif_fec,&lt;br/&gt;    A.DET_P_modif_usr,&lt;br/&gt;    A.DET_P_fecha_val_ini,&lt;br/&gt;    A.DET_P_fecha_val_fin,&lt;br/&gt;    A.DET_P_est_actual,&lt;br/&gt;    B.ID_TIPO_PRESUP,&lt;br/&gt;    B.NOMBRE;&lt;br/&gt;&lt;br/&gt;EXCEPTION &lt;br/&gt;        WHEN OTHERS THEN&lt;br/&gt;&lt;br/&gt;            ROLLBACK TO obtenerResultados;&lt;br/&gt;            RAISE;&lt;br/&gt;END;</body>
</StoredProcedureOraclev10g>